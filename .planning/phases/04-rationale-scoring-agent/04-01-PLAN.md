---
phase: 04-rationale-scoring-agent
type: execute
---

<objective>
Design and implement match scoring algorithm for discovered entities.

Purpose: Create a comprehensive scoring system that evaluates how well each discovered customer or partner matches the business context.
Output: Scoring algorithm that produces normalized match scores (0-100) with component breakdowns.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/models/business_context.py
@src/models/discovery_results.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create match score data model</name>
  <files>src/models/match_score.py</files>
  <action>
Create src/models/match_score.py:
- Dataclass: MatchScore with fields:
  - overall_score: float (0-100, weighted average of components)
  - relevance_score: float (0-100, how relevant to business)
  - geographic_fit: float (0-100, location alignment)
  - size_appropriateness: float (0-100, company size fit)
  - strategic_alignment: float (0-100, strategic fit)
  - score_breakdown: dict[str, float] (component scores)
  - confidence: str (High/Medium/Low based on data availability)
- Method: to_dict() for serialization
- Method: from_dict(data: dict) -> MatchScore
- Add docstrings explaining scoring components

Components ensure multi-dimensional evaluation

Avoid: Don't make scoring overly complex. Four dimensions cover key fit criteria.
  </action>
  <verify>
- src/models/match_score.py exists
- Imports: python -c "from src.models.match_score import MatchScore"
- Dataclass has all scoring components
- overall_score is 0-100 range
  </verify>
  <done>MatchScore data model created with component scoring</done>
</task>

<task type="auto">
  <name>Task 2: Implement scoring algorithm</name>
  <files>src/scoring/__init__.py, src/scoring/match_scorer.py</files>
  <action>
Create src/scoring/__init__.py (package initialization)

Create src/scoring/match_scorer.py:
- Class: MatchScorer
- __init__: Accept DiscoveryAgent (for AI-powered scoring)
- Method: score_match(company: CompanyInfo, context: BusinessContext, entity_type: str) -> MatchScore
  - Calculate relevance_score using agent (0-100 scale)
  - Calculate geographic_fit: compare company locations with context geography
  - Calculate size_appropriateness: evaluate if company size matches target market
  - Calculate strategic_alignment: complementary capabilities, market overlap
  - Compute overall_score: weighted average (relevance 40%, geographic 20%, size 20%, strategic 20%)
  - Determine confidence level based on data completeness
  - Return MatchScore instance
- Method: _calculate_geographic_fit(company_locations: list[str], context_geography: list[str]) -> float
  - Compare location lists
  - Return 100 if overlap exists, scale down based on geographic distance
- Method: _calculate_size_fit(company_size: str, context: BusinessContext) -> float
  - Map size (Small/Medium/Large) to score based on context target market
- Include logging for score calculations

Avoid: Don't make calculations too rigid (use fuzzy matching for locations). Don't ignore missing data (reflect in confidence).
  </action>
  <verify>
- src/scoring/match_scorer.py exists
- Imports: python -c "from src.scoring.match_scorer import MatchScorer"
- score_match method returns MatchScore
- Helper methods defined for component calculations
  </verify>
  <done>MatchScorer implemented with multi-dimensional scoring</done>
</task>

<task type="auto">
  <name>Task 3: Add scoring tests and validation</name>
  <files>tests/test_match_scorer.py</files>
  <action>
Create tests/test_match_scorer.py:
- Test: test_match_score_model
  - Create MatchScore instance
  - Verify overall_score in 0-100 range
  - Verify all components present
  - Test serialization/deserialization
- Test: test_geographic_fit_calculation
  - Test exact match (same location) → 100
  - Test partial match → intermediate score
  - Test no match → lower score
- Test: test_size_appropriateness
  - Test different size combinations
  - Verify scoring makes sense (e.g., Large company may not fit Small target market well)
- Mock test: test_score_match_workflow
  - Mock agent responses
  - Call score_match()
  - Verify MatchScore returned with valid scores
  - Verify overall_score is weighted average of components
- Test: test_confidence_levels
  - Complete data → High confidence
  - Missing data → Medium/Low confidence

Avoid: Don't test exact score values (will vary). Test ranges and logic correctness.
  </action>
  <verify>
- tests/test_match_scorer.py exists
- Tests run: python -m pytest tests/test_match_scorer.py -v
- Scoring logic validated through tests
- Edge cases covered (missing data, no geographic overlap)
  </verify>
  <done>Scoring tests created and validated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] MatchScore data model with four scoring components
- [ ] MatchScorer calculates multi-dimensional scores
- [ ] Overall score is weighted average of components
- [ ] Tests validate scoring logic
- [ ] Confidence level reflects data completeness
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Scoring algorithm produces 0-100 scores
- Component breakdown provides transparency
- Ready for rationale generation integration
</success_criteria>

<output>
After completion, create `.planning/phases/04-rationale-scoring-agent/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Match Scoring Algorithm Summary

**Multi-dimensional match scoring implemented**

## Accomplishments
- Created MatchScore data model with component scoring
- Implemented MatchScorer with four scoring dimensions
- Weighted scoring algorithm (relevance, geography, size, strategic fit)
- Added comprehensive tests for scoring logic
- Confidence levels based on data availability

## Files Created/Modified
- `src/models/match_score.py` - MatchScore data model
- `src/scoring/__init__.py` - Package initialization
- `src/scoring/match_scorer.py` - MatchScorer class
- `tests/test_match_scorer.py` - Scoring tests

## Decisions Made
- Four scoring components (relevance 40%, geographic 20%, size 20%, strategic 20%)
- 0-100 scale for all scores (intuitive, easy to compare)
- Confidence levels (High/Medium/Low) based on data completeness
- AI-powered relevance scoring, rule-based for geographic/size fit

## Issues Encountered
[Document any issues, or "None"]

## Next Step
Ready for 04-02-PLAN.md (Rationale generation agent)
</output>
