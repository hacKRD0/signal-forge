---
phase: 03-discovery-engine
type: execute
---

<objective>
Implement partner discovery logic with complementary business identification.

Purpose: Create the partner discovery pipeline that identifies complementary businesses and partnership opportunities based on business context.
Output: Working partner discovery module that returns 10 qualified partner candidates.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/03-discovery-engine/03-02-SUMMARY.md
@src/discovery/customer_discovery.py
@src/discovery/relevance_scorer.py
@src/discovery/web_search.py
@src/models/business_context.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create partner discovery orchestrator</name>
  <files>src/discovery/partner_discovery.py</files>
  <action>
Create src/discovery/partner_discovery.py:
- Class: PartnerDiscovery
- __init__: Accept DiscoveryAgent, WebSearchEngine, QueryBuilder
- Method: discover(context: BusinessContext, filters: dict = None, target_count: int = 10) -> DiscoveryResult
  - Generate partner queries using QueryBuilder (different strategy than customers)
  - Execute web search using WebSearchEngine
  - Get list of CompanyInfo candidates
  - Filter candidates based on partnership potential
  - Enrich top candidates
  - Return top N (target_count) candidates as DiscoveryResult
- Method: _filter_by_partnership_potential(candidates: list[CompanyInfo], context: BusinessContext) -> list[CompanyInfo]
  - Use agent to score partnership potential (complementary services, integration opportunities)
  - Remove low-scoring candidates
  - Return filtered list
- Method: _enrich_partner_info(company: CompanyInfo) -> CompanyInfo
  - Similar to customer enrichment but focus on partnership aspects
  - Return enriched CompanyInfo

Structure mirrors CustomerDiscovery for consistency

Avoid: Don't copy-paste customer logic - partner discovery looks for complementary businesses, not customers.
  </action>
  <verify>
- src/discovery/partner_discovery.py exists
- Imports: python -c "from src.discovery.partner_discovery import PartnerDiscovery"
- Methods mirror CustomerDiscovery structure
- discover method returns DiscoveryResult
  </verify>
  <done>PartnerDiscovery orchestrator created</done>
</task>

<task type="auto">
  <name>Task 2: Implement partnership relevance scoring</name>
  <files>src/discovery/relevance_scorer.py</files>
  <action>
Update src/discovery/relevance_scorer.py:
- Add method: score_partner_relevance(company: CompanyInfo, context: BusinessContext) -> float
  - Create prompt asking agent to score partnership potential (0.0-1.0)
  - Look for: complementary services, integration opportunities, shared target market, compatible business models
  - Include context about business products, market, strengths
  - Include candidate company info
  - Agent returns score with reasoning
  - Parse and return float score
- Update batch_score to accept entity_type parameter ("customer" or "partner")
  - Route to appropriate scoring method

Partnership criteria different from customer criteria: look for synergies, not need for services

Avoid: Don't use same logic as customer scoring - different evaluation criteria. Don't score unrealistic partnerships (direct competitors).
  </action>
  <verify>
- relevance_scorer.py updated
- New method: score_partner_relevance
- batch_score accepts entity_type parameter
- Imports still work without errors
  </verify>
  <done>Partnership relevance scoring implemented</done>
</task>

<task type="auto">
  <name>Task 3: Integrate partner discovery and add tests</name>
  <files>src/discovery/partner_discovery.py, tests/test_partner_discovery.py, src/discovery/__init__.py</files>
  <action>
Update src/discovery/partner_discovery.py:
- Import RelevanceScorer
- Update _filter_by_partnership_potential to use score_partner_relevance
- Set threshold to 0.6 (same as customer for consistency)
- Keep top 15-20 candidates, enrich top 10

Create tests/test_partner_discovery.py:
- Test: test_partner_discovery_initialization
- Mock test: test_discover_workflow_mock
  - Verify partner query generation differs from customer
  - Verify partnership scoring used (not customer scoring)
  - Verify workflow correct
- Test: test_partnership_filtering
  - Mock companies with varied partnership potential
  - Verify filtering works correctly

Update src/discovery/__init__.py:
- Export CustomerDiscovery, PartnerDiscovery, WebSearchEngine

Avoid: Don't duplicate all customer tests - focus on partnership-specific logic testing.
  </action>
  <verify>
- PartnerDiscovery uses RelevanceScorer with partnership mode
- tests/test_partner_discovery.py exists
- Tests run: python -m pytest tests/test_partner_discovery.py -v
- src/discovery/__init__.py exports both discovery classes
- Phase 3 complete
  </verify>
  <done>Partner discovery integrated, tested, and ready for use</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PartnerDiscovery class orchestrates partner discovery pipeline
- [ ] Partnership-specific relevance scoring implemented
- [ ] Tests verify partner discovery workflow
- [ ] Both CustomerDiscovery and PartnerDiscovery exportable
- [ ] Phase 3 complete - discovery engine functional
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Partner discovery pipeline functional
- Partnership scoring evaluates complementary fit
- Phase 3 complete - ready for rationale and scoring agent
</success_criteria>

<output>
After completion, create `.planning/phases/03-discovery-engine/03-03-SUMMARY.md`:

# Phase 3 Plan 3: Partner Discovery Summary

**Partner discovery pipeline implemented**

## Accomplishments
- Created PartnerDiscovery orchestrator
- Implemented partnership relevance scoring
- Integrated search, filtering, enrichment for partners
- Added tests for partner discovery
- Phase 3 complete: Full discovery engine operational

## Files Created/Modified
- `src/discovery/partner_discovery.py` - PartnerDiscovery class
- `src/discovery/relevance_scorer.py` - Added score_partner_relevance
- `tests/test_partner_discovery.py` - Partner discovery tests
- `src/discovery/__init__.py` - Export both discovery classes

## Decisions Made
- Partnership scoring focuses on complementary fit, not customer need
- Same threshold (0.6) for consistency
- Mirror customer discovery structure for maintainability
- Query generation strategy differs (complementary businesses)

## Issues Encountered
[Document any issues, or "None"]

## Next Step
Phase 3 complete. Ready for Phase 4: Rationale & Scoring Agent
</output>
