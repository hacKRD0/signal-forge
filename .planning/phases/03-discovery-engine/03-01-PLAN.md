---
phase: 03-discovery-engine
type: execute
---

<objective>
Implement web search integration and result parsing for discovery.

Purpose: Enable the Google ADK agent to perform web searches and extract structured company information from search results.
Output: Web search wrapper and result parser that extracts company details (name, website, location, size) from search results.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/agent/discovery_agent.py
@src/agent/query_builder.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery result data models</name>
  <files>src/models/discovery_results.py</files>
  <action>
Create src/models/discovery_results.py:
- Dataclass: CompanyInfo with fields:
  - name: str (company name)
  - website: str (URL)
  - locations: list[str] (where they operate)
  - size_estimate: str (Small/Medium/Large)
  - description: str (brief description from search results)
  - sources: list[str] (source URLs)
- Dataclass: DiscoveryResult with fields:
  - entity_type: str ("customer" or "partner")
  - companies: list[CompanyInfo]
  - query_used: str
  - timestamp: datetime
- Add to_dict() methods for JSON serialization
- Add from_dict() class methods for deserialization
- Add type hints and docstrings

Use dataclasses and datetime modules (built-in)

Avoid: Don't over-complicate. Keep data models simple and focused on required fields from brief.
  </action>
  <verify>
- src/models/discovery_results.py exists
- Imports: python -c "from src.models.discovery_results import CompanyInfo, DiscoveryResult"
- Both dataclasses have all specified fields
- Serialization methods present
  </verify>
  <done>Discovery result data models created with proper structure</done>
</task>

<task type="auto">
  <name>Task 2: Implement web search result parser</name>
  <files>src/discovery/__init__.py, src/discovery/search_parser.py</files>
  <action>
Create src/discovery/__init__.py (package initialization)

Create src/discovery/search_parser.py:
- Class: SearchResultParser
- Method: parse_company_info(search_result_text: str) -> CompanyInfo
  - Use Google ADK agent to extract structured company info from search result text
  - Prompt agent to identify: company name, website URL, locations, size estimate
  - Parse agent response into CompanyInfo instance
  - Handle missing fields with reasonable defaults
  - Include source URL extraction from result text
- Method: parse_multiple_results(results: list[str]) -> list[CompanyInfo]
  - Process multiple search results
  - Filter duplicates (same company name or website)
  - Return list of unique CompanyInfo instances
- Add error handling for malformed results
- Include logging for parsing process

Strategy: Agent receives search result snippet, returns JSON-like structured data

Avoid: Don't lose source URLs (needed for tracing). Don't include duplicate companies. Don't fail on missing optional fields.
  </action>
  <verify>
- src/discovery/search_parser.py exists
- Imports: python -c "from src.discovery.search_parser import SearchResultParser"
- Two methods defined: parse_company_info, parse_multiple_results
- Methods return appropriate types
  </verify>
  <done>SearchResultParser implemented with company info extraction</done>
</task>

<task type="auto">
  <name>Task 3: Create web search integration</name>
  <files>src/discovery/web_search.py</files>
  <action>
Create src/discovery/web_search.py:
- Class: WebSearchEngine
- __init__: Accept DiscoveryAgent instance
- Method: search(queries: list[str], max_results_per_query: int = 5) -> list[dict]
  - For each query, instruct agent to use built-in web search tool
  - Collect search results (agent returns results from Google ADK web search tool)
  - Combine results from all queries
  - Return list of search result dictionaries with: query, result_text, url, snippet
- Method: search_and_parse(queries: list[str]) -> list[CompanyInfo]
  - Call search() to get results
  - Use SearchResultParser to extract CompanyInfo from each result
  - Return deduplicated list of CompanyInfo instances
- Add rate limiting awareness (log warnings if many queries)
- Include error handling for search failures

Note: Google ADK agent has built-in web search tool - use agent's tool-calling capability

Avoid: Don't implement custom search API (use Google ADK built-in). Don't return raw results - parse to CompanyInfo.
  </action>
  <verify>
- src/discovery/web_search.py exists
- Imports: python -c "from src/discovery.web_search import WebSearchEngine"
- Two methods defined: search, search_and_parse
- Integration uses Google ADK's built-in web search tool
  </verify>
  <done>WebSearchEngine created with Google ADK web search integration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Discovery result data models exist (CompanyInfo, DiscoveryResult)
- [ ] SearchResultParser can extract company info from text
- [ ] WebSearchEngine integrates Google ADK web search tool
- [ ] All modules import without errors
- [ ] Deduplication logic prevents duplicate companies
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Web search integration uses Google ADK built-in tool
- Result parsing extracts structured company information
- Ready for customer and partner discovery logic
</success_criteria>

<output>
After completion, create `.planning/phases/03-discovery-engine/03-01-SUMMARY.md`:

# Phase 3 Plan 1: Web Search Integration Summary

**Web search and result parsing implemented**

## Accomplishments
- Created CompanyInfo and DiscoveryResult data models
- Implemented SearchResultParser for extracting company info
- Built WebSearchEngine using Google ADK web search tool
- Deduplication logic prevents duplicate entries

## Files Created/Modified
- `src/models/discovery_results.py` - CompanyInfo, DiscoveryResult models
- `src/discovery/__init__.py` - Package initialization
- `src/discovery/search_parser.py` - SearchResultParser class
- `src/discovery/web_search.py` - WebSearchEngine class

## Decisions Made
- Used Google ADK built-in web search tool (no external API needed)
- Parse results with agent (consistent with architecture)
- Deduplicate by company name and website (prevent duplicates)
- Max 5 results per query (balances coverage and quality)

## Issues Encountered
[Document any issues, or "None"]

## Next Step
Ready for 03-02-PLAN.md (Customer discovery logic)
</output>
