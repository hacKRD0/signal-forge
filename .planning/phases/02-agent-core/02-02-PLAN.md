---
phase: 02-agent-core
type: execute
---

<objective>
Implement context extraction from parsed documents using the Google ADK agent.

Purpose: Enable the system to understand business context from uploaded documents by extracting key information (industry, products, target market, geography) that will inform customer and partner discovery.
Output: Working context extraction pipeline that processes multiple documents and produces structured business context.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/02-agent-core/02-01-SUMMARY.md
@src/parsers/document_parser.py
@src/agent/discovery_agent.py
@src/agent/prompts.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create context extraction data models</name>
  <files>src/models/__init__.py, src/models/business_context.py</files>
  <action>
Create src/models/__init__.py (package initialization)

Create src/models/business_context.py:
- Dataclass: BusinessContext with fields:
  - company_name: str
  - industry: str
  - products_services: list[str]
  - target_market: str
  - geography: list[str] (regions where they operate)
  - key_strengths: list[str]
  - additional_notes: str
- Method: to_dict() -> dict for JSON serialization
- Method: from_dict(data: dict) -> BusinessContext for deserialization
- Method: to_prompt_string() -> str for including in agent prompts
- Add type hints and docstrings

Use dataclasses module (built-in, no dependencies needed)

Avoid: Don't over-complicate with ORMs. Keep it simple - this is for in-memory use and JSON serialization.
  </action>
  <verify>
- src/models/business_context.py exists
- Imports: python -c "from src.models.business_context import BusinessContext"
- Dataclass has all specified fields with type hints
- Methods defined: to_dict, from_dict, to_prompt_string
  </verify>
  <done>BusinessContext data model created with serialization methods</done>
</task>

<task type="auto">
  <name>Task 2: Implement multi-document context extraction</name>
  <files>src/agent/context_extractor.py</files>
  <action>
Create src/agent/context_extractor.py:
- Class: ContextExtractor
- __init__: Accept DiscoveryAgent instance
- Method: extract_from_files(file_paths: list[str]) -> BusinessContext
  - For each file: use parse_document() to get text
  - Combine all document texts with separators
  - Call agent.extract_context() with combined text
  - Parse agent response into BusinessContext instance
  - Handle missing fields gracefully with defaults
- Method: extract_from_text(text: str) -> BusinessContext
  - Direct text input (for testing)
  - Call agent.extract_context()
  - Parse into BusinessContext
- Include error handling for parsing failures, empty documents
- Add logging for extraction process
- Return structured BusinessContext object

Parsing strategy: Agent returns JSON-like text, use json.loads() or regex extraction to get structured data

Avoid: Don't fail if agent response format varies slightly - extract what's available. Don't lose information from multiple documents - merge intelligently.
  </action>
  <verify>
- src/agent/context_extractor.py exists
- Imports: python -c "from src.agent.context_extractor import ContextExtractor"
- Two methods defined: extract_from_files, extract_from_text
- Methods return BusinessContext instances
  </verify>
  <done>ContextExtractor implemented with multi-document processing</done>
</task>

<task type="auto">
  <name>Task 3: Add context extraction integration tests</name>
  <files>tests/test_context_extraction.py</files>
  <action>
Create tests/test_context_extraction.py:
- Test: test_business_context_serialization
  - Create BusinessContext instance
  - Test to_dict() produces correct dict
  - Test from_dict() reconstructs object
  - Test to_prompt_string() returns readable string
- Test: test_context_extractor_initialization
  - Create ContextExtractor
  - Verify it initializes without errors
- Mock test: test_extract_from_text_mock (using unittest.mock)
  - Mock agent response
  - Call extract_from_text()
  - Verify BusinessContext fields populated

Use pytest framework (add to requirements.txt if not present)

Note: Full integration test requires valid Google API key, so focus on mocks and data model tests

Avoid: Don't make tests depend on external APIs in CI. Use mocks for agent interactions.
  </action>
  <verify>
- tests/test_context_extraction.py exists
- Runs without errors: python -m pytest tests/test_context_extraction.py -v (or skip if pytest not installed yet)
- Tests cover data model and basic extractor functionality
  </verify>
  <done>Unit tests created for context extraction components</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] BusinessContext data model exists with all fields
- [ ] ContextExtractor class created with two extraction methods
- [ ] Tests created covering data model and extractor
- [ ] All modules import without errors
- [ ] Context extraction pipeline ready for use in discovery
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- BusinessContext model properly structured
- ContextExtractor can process multiple documents
- Unit tests verify core functionality
</success_criteria>

<output>
After completion, create `.planning/phases/02-agent-core/02-02-SUMMARY.md`:

# Phase 2 Plan 2: Context Extraction Summary

**Context extraction from documents implemented**

## Accomplishments
- Created BusinessContext data model with serialization
- Implemented ContextExtractor for multi-document processing
- Added unit tests for context extraction components
- Full pipeline from documents to structured context

## Files Created/Modified
- `src/models/__init__.py` - Models package
- `src/models/business_context.py` - BusinessContext data model
- `src/agent/context_extractor.py` - ContextExtractor class
- `tests/test_context_extraction.py` - Unit tests
- `requirements.txt` - Added pytest if needed

## Decisions Made
- Used dataclasses for BusinessContext (simple, built-in)
- Multi-document extraction combines all text before agent call (efficient)
- Graceful field extraction (missing fields get defaults)

## Issues Encountered
[Document any issues, or "None"]

## Next Step
Ready for 02-03-PLAN.md (Query formulation logic for discovery)
</output>
